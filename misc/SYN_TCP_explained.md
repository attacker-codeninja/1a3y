1. Ephemeral port was assigned on the Node1 and created socket associated with it by OS under Application, Presentation, and Session layers.
Node1 creates a TCP segment of the Transport layer and includes destination and source ports to appropriate fields. Also, the sequence and SYN flag are set. Finally, a checksum is calculated.
2. Then IP packet is created under the Network layer using IP addresses of both nodes and encapsulates TCP segment in the appropriate payload section. TTL is set to the default value of 64. The checksum is calculated for the hole thing.
3. IP packet passed to Data-link layer and Ethernet frame constructed by incapsulating this packet in the payload section. OS first checks its ARP table for the MAC address of the gateway (dynamic or static configured) because of the internetwork request (IP address of the Node2 not the same network).
4. In case the ARP table misses the gateway's MAC, an ARP request is sent. IP source of the Node1 and IP destination of the Router, source MAC address of the Node1 but destination MAC address is broadcast (FFFF.FFFF.FFFF)
5. After ARP response is received gateway's MAC address fills in the destination field of the created Ethernet frame. Checksum calculated and filled in FCS field.
6. Frame sends through Physical layer as a bitstream (voltage modulation in case of twisted pair or copper cabling).
7. Frame received on the Router side and verify that its MAC address match with destination MAC address, then calculates checksum and compare with the checksum of the Frame. The next step is to de-encapsulate from L2 (Ethernet frame) to L3 (IP packet) and again calculate checksum and compare with the checksum of the IP packet. Router examines destination IP address in its Routing table (performs a lookup) to know the shortest path. TTL decrements by one, calculates new checksum, and creates a new IP packet.
8. The Router makes a new Ethernet frame which consists of new MAC addresses that changes to the source MAC of the router and destination MAC of the Node2 found on the Router's ARP table. Once all fields are filled in, IP packet is placed in the payload section of the frame and calculates a checksum and filled out in the FCS field. Frame is sent out to Node2.
9. Node2 inspects the received frame and verifies its own MAC address includes as a destination, then calculates checksum and compares with the checksum of the Frame. If the checksum matches Node2 de-encapsulates frame to IP packet, calculates checksum and compares with the checksum of the packet, then examines the destination IP address and recognizes it as its own. So, packet de-encapsulates to segment of the Transport layer and checksum checks out. Examines destination port and verify that there is an open socket on this port and it has LISTEN state. Then Node2 see the SYN flag has set, so examines sequence number and store it since it will need to put it back in the acknowledgment field in the response segment.